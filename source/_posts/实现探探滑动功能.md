---
title: RecyclerView实现探探卡片滑动功能
date: 2018-10-07 10:35:56
tags: RecyclerView
---
# 代码实现
博客地址：https://blog.csdn.net/qq_39085422/article/details/78612132
我只掌握了RecyclerView基础用法，所以参考别人博客的代码实现。
我使用CardView代替RoundImageView实现圆角效果。

# 遇到的问题
# 1.CardView阴影显示不完全
[![Card_View_border.jpg](https://i.postimg.cc/VkRn0SyD/Card_View_border.jpg)](https://postimg.cc/nXXC6hhD)
原因：将CardView作为最外层布局，可能是两个CardView重叠时，边界会融合到一起。
解决方法：在外层再套一层布局，比如LinearLayout之类的。
解决后效果图：
[![Card_View.jpg](https://i.postimg.cc/66mHTmVy/Card_View.jpg)](https://postimg.cc/pyKQ6k6H)
在文末会贴出我的布局代码。


# 2.左右滑，滑出时卡顿(未解决)
原因：adapter.notifyDataSetChanged();
卡片滑出后需要删除对应的数据，对数据源进行remove()操作，之后通知adapter,这个时候会发生卡顿

# 3.向上下滑动时，动画衔接的不好
原因：临界值计算公式不合理，只计算了在X轴的偏移量
解决：CardItemTouchHelperCallback类中的onChildDraw()里，
解决前代码：
```
float ratio = dX / getThreshold(recyclerView, viewHolder);
```
解决后代码：
```
float distance = (float)Math.sqrt(dX*dX+dY*dY);
float ratio = distance / getThreshold(recyclerView, viewHolder);
```
变化：增加了distance变量，计算位移两点间的直线距离。

# 拓展
如果你搜索卡片层叠效果，你会发现更多更详细的内容

# 总结：
折腾了好久也无法像探探那样流畅，只能朝四个方向滑出，而不能360°滑出。
流畅度效果也有不少差距，可见自己水平还有待提高。

# 相关代码：
## item_card_slide.xml
```
<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="336dp"
    android:layout_height="426dp">

    <android.support.v7.widget.CardView
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        app:cardCornerRadius="7.5dp"
        app:cardElevation="1dp"
        app:cardUseCompatPadding="true">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:background="#ffffff"
            android:orientation="vertical">

            <RelativeLayout
                android:layout_width="match_parent"
                android:layout_height="0dp"
                android:layout_weight="1">

                <ImageView
                    android:id="@+id/iv_avatar"
                    android:layout_width="match_parent"
                    android:layout_height="match_parent"
                    android:scaleType="centerCrop"
                    android:background="@color/pink"/>

                <ImageView
                    android:id="@+id/iv_dislike"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_alignParentRight="true"
                    android:layout_marginRight="15dp"
                    android:layout_marginTop="15dp"
                    android:alpha="0"
                    android:background="@color/blue"/>

                <ImageView
                    android:id="@+id/iv_like"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_alignParentRight="true"
                    android:layout_marginRight="15dp"
                    android:layout_marginTop="15dp"
                    android:alpha="0"
                    android:background="@color/grey"/>

            </RelativeLayout>
            <RelativeLayout
                android:layout_width="match_parent"
                android:layout_height="100dp"
                android:paddingLeft="14dp"
                android:paddingTop="15dp">
                <TextView
                    android:id="@+id/tv_name"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:gravity="center"
                    android:text="小姐姐"
                    android:textColor="@android:color/black"
                    android:textSize="16sp" />

                <TextView
                    android:id="@+id/tv_age"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_below="@id/tv_name"
                    android:layout_marginTop="5dp"
                    android:background="@color/pink"
                    android:gravity="center"
                    android:text="♀ 23"
                    android:textColor="#FFFFFF"
                    android:textSize="14sp" />

                <TextView
                    android:id="@+id/tv_constellation"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_below="@id/tv_name"
                    android:layout_marginLeft="4dp"
                    android:layout_marginTop="5dp"
                    android:layout_toRightOf="@id/tv_age"
                    android:background="@color/olivedrab"
                    android:gravity="center"
                    android:text="狮子座"
                    android:textColor="#FFFFFF"
                    android:textSize="14sp" />

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_below="@id/tv_age"
                    android:layout_marginTop="5dp"
                    android:gravity="center"
                    android:text="IT/互联网"
                    android:textColor="#cbcbcb" />

            </RelativeLayout>
        </LinearLayout>
    </android.support.v7.widget.CardView>

</RelativeLayout>
```